var d=Object.defineProperty;var l=(t,e,o)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var a=(t,e,o)=>l(t,typeof e!="symbol"?e+"":e,o);class c{constructor(e){a(this,"config",null);a(this,"workshopId",null);a(this,"observers",new Set);a(this,"initialized",!1);this.workshopId=e||this.detectWorkshopId()}async initialize(){try{await this.loadConfiguration(),this.applyBranding(),this.setupDynamicUpdates(),this.initialized=!0,console.log("ðŸŽ¨ Branding system initialized for workshop:",this.workshopId)}catch(e){console.error("Failed to initialize branding system:",e),await this.loadDefaultBranding()}}async loadConfiguration(){if(!this.workshopId)throw new Error("Workshop ID not available");try{const e=await this.fetchBrandingConfig(this.workshopId);this.config=e.data}catch(e){console.warn("Failed to load branding config, using defaults:",e),await this.loadDefaultBranding()}}async fetchBrandingConfig(e){return typeof window<"u"&&window.frappe?.call?await window.frappe.call({method:"universal_workshop.api.get_branding_config",args:{workshop_id:e}}):{data:this.getDefaultBrandingConfig()}}async loadDefaultBranding(){this.config=this.getDefaultBrandingConfig()}getDefaultBrandingConfig(){return{colors:{primary:"#1976d2",secondary:"#dc004e",accent:"#9c27b0",success:"#4caf50",warning:"#ff9800",error:"#f44336",info:"#2196f3",background:"#fafafa",surface:"#ffffff",onPrimary:"#ffffff",onSecondary:"#ffffff",onBackground:"#212121",onSurface:"#212121",border:"#e0e0e0",divider:"#bdbdbd",shadow:"rgba(0, 0, 0, 0.12)"},logos:{main:"/assets/universal_workshop/images/logo.png",light:"/assets/universal_workshop/images/logo-light.png",dark:"/assets/universal_workshop/images/logo-dark.png",favicon:"/assets/universal_workshop/images/favicon.ico",mobile:"/assets/universal_workshop/images/logo-mobile.png",print:"/assets/universal_workshop/images/logo-print.png"},typography:{fontFamily:{arabic:["Cairo","Amiri","sans-serif"],latin:["Inter","Roboto","sans-serif"]},fontSize:{xs:"0.75rem",sm:"0.875rem",base:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem"},fontWeight:{light:300,normal:400,medium:500,semibold:600,bold:700},lineHeight:{tight:1.25,normal:1.5,relaxed:1.75}},layout:{sidebar:{width:"280px",collapsible:!0,position:"left"},header:{height:"64px",fixed:!0,transparent:!1},content:{maxWidth:"1200px",padding:"24px",centered:!0}},theme:{mode:"light",highContrast:!1,animations:!0,reducedMotion:!1,compactMode:!1}}}applyBranding(){this.config&&(this.applyCSSVariables(),this.applyLogos(),this.applyTypography(),this.notifyObservers())}applyCSSVariables(){if(!this.config)return;const e=document.documentElement,{colors:o,layout:i,typography:s}=this.config;Object.entries(o).forEach(([r,n])=>{e.style.setProperty(`--color-${this.kebabCase(r)}`,n)}),e.style.setProperty("--sidebar-width",i.sidebar.width),e.style.setProperty("--header-height",i.header.height),e.style.setProperty("--content-max-width",i.content.maxWidth),e.style.setProperty("--content-padding",i.content.padding),Object.entries(s.fontSize).forEach(([r,n])=>{e.style.setProperty(`--font-size-${r}`,n)}),Object.entries(s.fontWeight).forEach(([r,n])=>{e.style.setProperty(`--font-weight-${r}`,n.toString())})}applyLogos(){if(!this.config?.logos)return;this.updateFavicon(this.config.logos.favicon),document.querySelectorAll("[data-logo]").forEach(o=>{const i=o.getAttribute("data-logo");i&&this.config?.logos[i]&&(o.src=this.config.logos[i])})}updateFavicon(e){let o=document.querySelector('link[rel="icon"]');o||(o=document.createElement("link"),o.rel="icon",document.head.appendChild(o)),o.href=e}applyTypography(){if(!this.config?.typography)return;const e=document.documentElement,{fontFamily:o}=this.config.typography,s=document.documentElement.lang==="ar"||document.documentElement.dir==="rtl"?o.arabic:o.latin;e.style.setProperty("--font-family-primary",s.join(", "))}setupDynamicUpdates(){typeof window<"u"&&window.addEventListener("branding-update",this.handleBrandingUpdate.bind(this)),setInterval(()=>{this.refreshBranding()},5*60*1e3)}handleBrandingUpdate(e){e.detail?.workshopId===this.workshopId&&(this.config=e.detail.config,this.applyBranding())}async refreshBranding(){if(this.initialized)try{await this.loadConfiguration(),this.applyBranding()}catch(e){console.warn("Failed to refresh branding:",e)}}async updateConfig(e){if(this.config){this.config={...this.config,...e},this.applyBranding();try{await this.saveBrandingConfig(this.config)}catch(o){console.error("Failed to save branding config:",o)}}}async saveBrandingConfig(e){typeof window<"u"&&window.frappe?.call&&await window.frappe.call({method:"universal_workshop.api.save_branding_config",args:{workshop_id:this.workshopId,config:e}})}getCurrentConfig(){return this.config}subscribe(e){this.observers.add(e)}unsubscribe(e){this.observers.delete(e)}notifyObservers(){this.observers.forEach(e=>{try{e(this.config)}catch(o){console.error("Error notifying branding observer:",o)}})}detectWorkshopId(){if(typeof window<"u"&&window.frappe?.boot)return window.frappe.boot.user?.name||null;const o=new URLSearchParams(window.location.search).get("workshop");return o||localStorage.getItem("workshopId")}kebabCase(e){return e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}}new c;export{c as B};
//# sourceMappingURL=branding-system-8S7Zd6Pf.js.map
