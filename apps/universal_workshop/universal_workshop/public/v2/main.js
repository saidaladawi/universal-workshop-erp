var f=Object.defineProperty;var g=(a,e,i)=>e in a?f(a,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[e]=i;var o=(a,e,i)=>g(a,typeof e!="symbol"?e+"":e,i);import{c as p}from"./chunks/vendor-2yTeQ_DO.js";import{B as w}from"./chunks/branding-system-8S7Zd6Pf.js";import{P as y}from"./chunks/monitor-QC5JCVak.js";const c=class c{constructor(){o(this,"config",null);o(this,"currentSession",null);o(this,"timeoutWarningTimer",null);o(this,"sessionTimeoutTimer",null);o(this,"activityListeners",new Set);o(this,"initialized",!1);this.bindActivityListeners()}static getInstance(){return c.instance||(c.instance=new c),c.instance}async initialize(){try{await this.loadSessionConfig(),await this.loadCurrentSession(),this.startSessionMonitoring(),this.initialized=!0,console.log("üîê Session manager initialized")}catch(e){console.error("Failed to initialize session manager:",e),this.loadDefaultConfig()}}async loadSessionConfig(){try{if(typeof window<"u"&&window.frappe?.call){const e=await window.frappe.call({method:"universal_workshop.api.get_session_config"});this.config=e.data}else this.loadDefaultConfig()}catch(e){console.warn("Failed to load session config, using defaults:",e),this.loadDefaultConfig()}}loadDefaultConfig(){this.config={timeout:30*60*1e3,warningTime:5*60*1e3,extendable:!0,multiDevice:!0,securityLevel:"enhanced"}}async loadCurrentSession(){try{if(typeof window<"u"&&window.frappe?.call){const e=await window.frappe.call({method:"universal_workshop.api.get_current_session"});this.currentSession=e.data}else this.currentSession=this.createMockSession()}catch(e){console.warn("Failed to load current session:",e),this.currentSession=this.createMockSession()}}createMockSession(){const e=new Date;return{id:"mock-session-"+Date.now(),userId:"test-user",deviceInfo:this.getDeviceInfo(),startTime:e,lastActivity:e,expiresAt:new Date(e.getTime()+(this.config?.timeout||30*60*1e3)),isActive:!0}}startSessionMonitoring(){!this.config||!this.currentSession||(this.resetSessionTimers(),this.trackUserActivity())}resetSessionTimers(){this.config&&(this.timeoutWarningTimer&&clearTimeout(this.timeoutWarningTimer),this.sessionTimeoutTimer&&clearTimeout(this.sessionTimeoutTimer),this.timeoutWarningTimer=window.setTimeout(()=>{this.showTimeoutWarning()},this.config.timeout-this.config.warningTime),this.sessionTimeoutTimer=window.setTimeout(()=>{this.handleSessionTimeout()},this.config.timeout))}showTimeoutWarning(){const e=Math.floor((this.config?.warningTime||0)/1e3/60);typeof window<"u"&&window.frappe?.msgprint?window.frappe.msgprint(`Your session will expire in ${e} minutes. Do you want to extend it?`,"Session Timeout Warning"):confirm(`Your session will expire in ${e} minutes. Do you want to extend it?`)&&this.extendSession()}handleSessionTimeout(){console.warn("‚è∞ Session has timed out"),this.currentSession=null,this.clearTimers(),typeof window<"u"&&(window.frappe?(window.frappe.msgprint("Your session has expired. Please log in again.","Session Expired"),setTimeout(()=>{window.location.href="/login"},2e3)):(alert("Your session has expired. Please log in again."),window.location.reload()))}async extendSession(){if(!(!this.currentSession||!this.config))try{if(typeof window<"u"&&window.frappe?.call){const e=await window.frappe.call({method:"universal_workshop.api.extend_session",args:{session_id:this.currentSession.id}});e.success&&(this.currentSession.expiresAt=new Date(e.data.expiresAt),this.resetSessionTimers(),console.log("‚úÖ Session extended successfully"))}else this.currentSession.expiresAt=new Date(Date.now()+this.config.timeout),this.resetSessionTimers()}catch(e){console.error("Failed to extend session:",e)}}trackUserActivity(){const e=["mousedown","mousemove","keypress","scroll","touchstart"],i=()=>{this.updateLastActivity()};e.forEach(n=>{document.addEventListener(n,i,!0)}),this.activityListeners.add(()=>{e.forEach(n=>{document.removeEventListener(n,i,!0)})})}updateLastActivity(){this.currentSession&&(this.currentSession.lastActivity=new Date,this.config?.extendable&&this.resetSessionTimers())}bindActivityListeners(){document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.checkSessionValidity()}),window.addEventListener("online",()=>{this.checkSessionValidity()})}async checkSessionValidity(){if(this.currentSession)try{typeof window<"u"&&window.frappe?.call&&((await window.frappe.call({method:"universal_workshop.api.validate_session",args:{session_id:this.currentSession.id}})).data.valid||this.handleSessionTimeout())}catch(e){console.warn("Failed to validate session:",e)}}getDeviceInfo(){const e=navigator.userAgent,i=navigator.platform;let n="desktop";/Mobile|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)&&(n=/iPad/i.test(e)?"tablet":"mobile");let t="Unknown";e.includes("Chrome")?t="Chrome":e.includes("Firefox")?t="Firefox":e.includes("Safari")?t="Safari":e.includes("Edge")&&(t="Edge");let s="Unknown";return i.includes("Win")?s="Windows":i.includes("Mac")?s="macOS":i.includes("Linux")?s="Linux":e.includes("Android")?s="Android":(e.includes("iPhone")||e.includes("iPad"))&&(s="iOS"),{type:n,browser:t,os:s,screenResolution:`${screen.width}x${screen.height}`,userAgent:e}}clearTimers(){this.timeoutWarningTimer&&(clearTimeout(this.timeoutWarningTimer),this.timeoutWarningTimer=null),this.sessionTimeoutTimer&&(clearTimeout(this.sessionTimeoutTimer),this.sessionTimeoutTimer=null)}getCurrentSession(){return this.currentSession}getConfig(){return this.config}isSessionActive(){return this.currentSession?.isActive||!1}getTimeUntilExpiry(){return this.currentSession?Math.max(0,this.currentSession.expiresAt.getTime()-Date.now()):0}destroy(){this.clearTimers(),this.activityListeners.forEach(e=>e()),this.activityListeners.clear(),this.currentSession=null,this.initialized=!1}};o(c,"instance",null);let m=c;class d{static convertToArabicNumerals(e){return e.replace(/[0-9]/g,i=>this.ARABIC_NUMERALS[parseInt(i,10)])}static convertToLatinNumerals(e){return e.replace(/[Ÿ†-Ÿ©]/g,i=>this.LATIN_NUMERALS[this.ARABIC_NUMERALS.indexOf(i)])}static containsArabic(e){return this.ARABIC_UNICODE_RANGES.some(([i,n])=>{for(let t=0;t<e.length;t++){const s=e.charCodeAt(t);if(s>=i&&s<=n)return!0}return!1})}static getTextDirection(e){return!e||e.trim().length===0?"ltr":this.containsArabic(e)?"rtl":"ltr"}static isArabicLocale(e){return(e||document.documentElement.lang||navigator.language||"en").toLowerCase().startsWith("ar")}static formatNumber(e,i={}){const{useArabicNumerals:n=!0,currency:t="OMR",style:s="decimal",minimumFractionDigits:r,maximumFractionDigits:l}=i;let u;return s==="currency"?u=new Intl.NumberFormat("ar-OM",{style:"currency",currency:t,minimumFractionDigits:r,maximumFractionDigits:l}).format(e):s==="percent"?u=new Intl.NumberFormat("ar-OM",{style:"percent",minimumFractionDigits:r,maximumFractionDigits:l}).format(e):u=new Intl.NumberFormat("ar-OM",{minimumFractionDigits:r,maximumFractionDigits:l}).format(e),n?this.convertToArabicNumerals(u):u}static formatCurrency(e,i={}){const{useArabicNumerals:n=!0,showCurrencySymbol:t=!0,precision:s=3}=i;return this.formatNumber(e,{style:t?"currency":"decimal",currency:"OMR",minimumFractionDigits:s,maximumFractionDigits:s,useArabicNumerals:n})}static formatDate(e,i={}){const{style:n="medium",useArabicNumerals:t=!0,includeTime:s=!1}=i,r={dateStyle:n};s&&(r.timeStyle="short");let l=new Intl.DateTimeFormat("ar-OM",r).format(e);return t?this.convertToArabicNumerals(l):l}static applyRTLStyling(e){e.dir="rtl",e.style.textAlign="right",e.classList.add("rtl-element")}static removeRTLStyling(e){e.dir="ltr",e.style.textAlign="left",e.classList.remove("rtl-element")}static autoApplyDirection(e,i){const n=i||e.textContent||e.innerText||"",t=this.getTextDirection(n);e.dir=t,e.style.textAlign=t==="rtl"?"right":"left"}static getArabicPlural(e,i,n,t){return e===0?t||i:e===1?i:e===2&&n?n:t||i}static isValidArabicText(e){return!e||e.trim().length===0?!1:this.containsArabic(e)&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF\s\d\.\,\!\?\-\(\)]+$/.test(e)}static cleanArabicText(e){return e.replace(/[\u200C\u200D\u200E\u200F]/g,"").replace(/\s+/g," ").trim()}static getRTLSpacing(e,i,n,t,s=!1){return s?`${e} ${t} ${n} ${i}`:`${e} ${i} ${n} ${t}`}static convertCSSForRTL(e,i,n=!1){if(!n)return{property:e,value:i};const t={"padding-left":"padding-right","padding-right":"padding-left","margin-left":"margin-right","margin-right":"margin-left","border-left":"border-right","border-right":"border-left",left:"right",right:"left","text-align":i==="left"?"right":i==="right"?"left":i},s=t[e]||e,r=e==="text-align"?t[e]:i;return{property:s,value:r||i}}static setupGlobalArabicEnvironment(){if(this.isArabicLocale()){document.documentElement.dir="rtl",document.documentElement.lang="ar",document.documentElement.classList.add("arabic-layout");const i=document.createElement("link");i.rel="stylesheet",i.href="/assets/universal_workshop/css/arabic-rtl.css",i.onload=()=>console.log("‚úÖ Arabic RTL styles loaded"),i.onerror=()=>console.log("‚ö†Ô∏è Arabic RTL styles not found"),document.head.appendChild(i)}}static createBilingualElement(e,i,n=!1){const t=document.createElement("div");t.className="bilingual-text";const s=document.createElement("span");s.className="text-en",s.textContent=e,s.dir="ltr";const r=document.createElement("span");return r.className="text-ar",r.textContent=i,r.dir="rtl",n?(t.appendChild(r),t.appendChild(s)):(t.appendChild(s),t.appendChild(r)),t}}o(d,"ARABIC_NUMERALS",["Ÿ†","Ÿ°","Ÿ¢","Ÿ£","Ÿ§","Ÿ•","Ÿ¶","Ÿß","Ÿ®","Ÿ©"]),o(d,"LATIN_NUMERALS",["0","1","2","3","4","5","6","7","8","9"]),o(d,"ARABIC_UNICODE_RANGES",[[1536,1791],[1872,1919],[2208,2303],[64336,65023],[65136,65279]]);class S{constructor(){o(this,"app",null);o(this,"brandingSystem",null);o(this,"sessionManager",null);o(this,"performanceMonitor",null)}async initialize(){try{this.performanceMonitor=y.getInstance(),this.performanceMonitor.measurePageLoad(),await this.initializeBrandingSystem(),await this.initializeSessionManager(),await this.initializeArabicSupport(),console.log("üöÄ Universal Workshop Frontend V2 initialized successfully")}catch(e){throw console.error("‚ùå Failed to initialize Universal Workshop Frontend V2:",e),e}}async initializeBrandingSystem(){if(!window.frappe?.boot?.user){console.warn("‚ö†Ô∏è Frappe not available, using default branding");return}this.brandingSystem=new w,await this.brandingSystem.initialize()}async initializeSessionManager(){this.sessionManager=m.getInstance(),await this.sessionManager.initialize()}async initializeArabicSupport(){d.isArabicLocale(document.documentElement.lang)&&(document.documentElement.dir="rtl",document.documentElement.classList.add("arabic-layout"))}createVueApp(e,i){return this.app=p(e),this.app.config.globalProperties.$branding=this.brandingSystem,this.app.config.globalProperties.$session=this.sessionManager,this.app.config.globalProperties.$arabic=d,this.app.mount(i),this.app}getApp(){return this.app}}const h=new S;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{h.initialize()}):h.initialize();typeof window<"u"&&(window.UniversalWorkshopApp=h);export{h as u};
//# sourceMappingURL=main.js.map
