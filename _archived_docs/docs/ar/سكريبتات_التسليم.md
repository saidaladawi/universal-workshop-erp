# ุณูุฑูุจุชุงุช ุงูุชุณููู ุงูุฌุงูุฒุฉ
## ูุฌููุนุฉ ุดุงููุฉ ูู ุงูุณูุฑูุจุชุงุช ุงููุทููุจุฉ ูุชุณููู ุงููุธุงู

---

## ๐ ูููู ูุฌูุฏ ุงูุณูุฑูุจุชุงุช

```
scripts/
โโโ developer/
โ   โโโ setup_dev_environment.sh
โ   โโโ create_client_branch.sh
โ   โโโ generate_license.py
โ   โโโ build_client_package.sh
โ   โโโ pre_delivery_test.py
โโโ installation/
โ   โโโ client_installer.sh
โ   โโโ setup_database.sh
โ   โโโ configure_system.sh
โ   โโโ production_setup.sh
โโโ maintenance/
โ   โโโ backup_system.sh
โ   โโโ monitor_health.py
โ   โโโ update_system.sh
โ   โโโ troubleshoot.sh
โโโ delivery/
    โโโ create_delivery_package.sh
    โโโ setup_remote_support.sh
    โโโ client_handover.sh
    โโโ generate_documentation.sh
```

---

## ๐๏ธ ุณูุฑูุจุชุงุช ุงููุทูุฑ

### 1. ุฅุนุฏุงุฏ ุจูุฆุฉ ุงูุชุทููุฑ
```bash
#!/bin/bash
# scripts/developer/setup_dev_environment.sh

CLIENT_NAME="$1"
CLIENT_CODE="$2"

if [ -z "$CLIENT_NAME" ] || [ -z "$CLIENT_CODE" ]; then
    echo "ุงูุงุณุชุฎุฏุงู: $0 <ุงุณู_ุงูุนููู> <ููุฏ_ุงูุนููู>"
    exit 1
fi

echo "๐๏ธ ุฅุนุฏุงุฏ ุจูุฆุฉ ุงูุชุทููุฑ ููุนููู: $CLIENT_NAME"

# ุฅูุดุงุก ูุฌูุฏ ุงูุนููู
DEV_DIR="$HOME/development/clients/$CLIENT_CODE"
mkdir -p "$DEV_DIR"
cd "$DEV_DIR"

# ุงุณุชูุณุงุฎ ุงููุดุฑูุน
echo "๐ฅ ุงุณุชูุณุงุฎ ุงููุดุฑูุน ุงูุฃุณุงุณู..."
git clone https://github.com/saidaladawi/universal-workshop-erp.git
cd universal-workshop-erp

# ุฅูุดุงุก ูุฑุน ุงูุนููู
echo "๐ฟ ุฅูุดุงุก ูุฑุน ุงูุนููู..."
git checkout -b "client/$CLIENT_CODE"

# ุฅุนุฏุงุฏ ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
echo "๐ ุฅุนุฏุงุฏ ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ..."
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install frappe-bench

# ุฅูุดุงุก bench
echo "โ๏ธ ุฅูุดุงุก bench ููุนููู..."
bench init --frappe-branch version-15 "${CLIENT_CODE}-bench"
cd "${CLIENT_CODE}-bench"

# ุฅุถุงูุฉ ุงูุชุทุจููุงุช
echo "๐ฑ ุฅุถุงูุฉ ุงูุชุทุจููุงุช..."
bench get-app --branch version-15 erpnext
bench get-app ../

# ุฅูุดุงุก ูููุน ุชุทููุฑู
echo "๐ ุฅูุดุงุก ุงููููุน ุงูุชุทููุฑู..."
bench new-site "dev-${CLIENT_CODE}.local" --admin-password "admin123"
bench --site "dev-${CLIENT_CODE}.local" install-app erpnext
bench --site "dev-${CLIENT_CODE}.local" install-app universal_workshop

# ุฅุนุฏุงุฏ ููู ุงูุชูููู
cat > "client_config.json" << EOF
{
    "client_name": "$CLIENT_NAME",
    "client_code": "$CLIENT_CODE",
    "development_site": "dev-${CLIENT_CODE}.local",
    "production_domain": "${CLIENT_CODE}.workshop.local",
    "created_date": "$(date -I)",
    "developer": "$(whoami)",
    "status": "development"
}
EOF

echo "โ ุชู ุฅุนุฏุงุฏ ุจูุฆุฉ ุงูุชุทููุฑ ุจูุฌุงุญ!"
echo "๐ ูุณุงุฑ ุงููุดุฑูุน: $DEV_DIR/universal-workshop-erp/${CLIENT_CODE}-bench"
echo "๐ ุงููููุน ุงูุชุทููุฑู: dev-${CLIENT_CODE}.local"
echo "๐ ูุจุฏุก ุงูุชุทููุฑ: cd $DEV_DIR/universal-workshop-erp/${CLIENT_CODE}-bench && bench start"
```

### 2. ุชูููุฏ ุงูุชุฑุฎูุต
```python
#!/usr/bin/env python3
# scripts/developer/generate_license.py

import sys
import json
import hashlib
import base64
import uuid
from datetime import datetime, timedelta
from cryptography.fernet import Fernet

class LicenseGenerator:
    def __init__(self):
        # ููุชุงุญ ุงูุชุดููุฑ ุงูุฑุฆูุณู - ูุฌุจ ุชุบููุฑู ูุญูุธู ุจุฃูุงู
        self.master_key = "UW2025-MASTER-KEY-CHANGE-THIS-IN-PRODUCTION"
        
        # ุฅูุดุงุก ููุชุงุญ ุงูุชุดููุฑ
        key = hashlib.sha256(self.master_key.encode()).digest()
        self.cipher_suite = Fernet(base64.urlsafe_b64encode(key))
    
    def generate_hardware_fingerprint(self, client_info):
        """ุชูููุฏ ุจุตูุฉ ูุฑูุฏุฉ ููุนููู"""
        fingerprint_data = {
            "company_name": client_info["company_name"],
            "commercial_register": client_info.get("commercial_register", ""),
            "contact_email": client_info.get("contact_email", ""),
            "deployment_location": client_info.get("location", ""),
            "server_identifier": str(uuid.uuid4())
        }
        
        # ุฅูุดุงุก hash ูุฑูุฏ
        data_string = json.dumps(fingerprint_data, sort_keys=True)
        return hashlib.sha256(data_string.encode()).hexdigest()
    
    def create_license(self, client_info):
        """ุฅูุดุงุก ุชุฑุฎูุต ุฌุฏูุฏ"""
        
        # ุจูุงูุงุช ุงูุชุฑุฎูุต
        license_data = {
            "license_id": f"UW-{datetime.now().year}-{client_info['client_code']}",
            "version": "2.0",
            "client_name": client_info["company_name"],
            "client_code": client_info["client_code"],
            "license_type": "permanent_full_scrap",
            "features": {
                "workshop_management": True,
                "scrap_management": True,
                "arabic_localization": True,
                "omani_compliance": True,
                "unlimited_users": True,
                "unlimited_vehicles": True,
                "mobile_app": True,
                "api_access": True,
                "custom_reports": True
            },
            "issue_date": datetime.now().isoformat(),
            "expires": None,  # ุฏุงุฆู
            "hardware_fingerprint": self.generate_hardware_fingerprint(client_info),
            "support_expires": (datetime.now() + timedelta(days=365)).isoformat(),
            "max_concurrent_users": -1,  # ุบูุฑ ูุญุฏูุฏ
            "max_vehicles": -1,  # ุบูุฑ ูุญุฏูุฏ
            "issued_by": "Universal Workshop ERP Team",
            "signature": ""
        }
        
        # ุฅูุดุงุก ุงูุชูููุน ุงูุฑููู
        license_string = json.dumps(license_data, sort_keys=True)
        signature = hashlib.sha256((license_string + self.master_key).encode()).hexdigest()
        license_data["signature"] = signature
        
        # ุชุดููุฑ ุงูุชุฑุฎูุต
        encrypted_license = self.cipher_suite.encrypt(json.dumps(license_data).encode())
        
        return base64.b64encode(encrypted_license).decode()
    
    def decode_license(self, license_key):
        """ูู ุชุดููุฑ ุงูุชุฑุฎูุต ูุนุฑุถ ุงููุนูููุงุช"""
        try:
            encrypted_data = base64.b64decode(license_key.encode())
            decrypted_data = self.cipher_suite.decrypt(encrypted_data)
            return json.loads(decrypted_data.decode())
        except Exception as e:
            return {"error": f"ูุดู ูู ุงูุชุดููุฑ: {str(e)}"}


def main():
    if len(sys.argv) < 3:
        print("ุงูุงุณุชุฎุฏุงู: python generate_license.py <ุงุณู_ุงูุดุฑูุฉ> <ููุฏ_ุงูุนููู> [ุงูุณุฌู_ุงูุชุฌุงุฑู] [ุงูุจุฑูุฏ_ุงูุฅููุชุฑููู]")
        print("ูุซุงู: python generate_license.py 'ูุฑุดุฉ ุงูููุฑ ููุณูุงุฑุงุช' 'ALNOOR001' '1234567890' 'info@alnoor.om'")
        sys.exit(1)
    
    # ูุนูููุงุช ุงูุนููู ูู ุงููุนุงููุงุช
    client_info = {
        "company_name": sys.argv[1],
        "client_code": sys.argv[2],
        "commercial_register": sys.argv[3] if len(sys.argv) > 3 else "",
        "contact_email": sys.argv[4] if len(sys.argv) > 4 else "",
        "location": "Sultanate of Oman"
    }
    
    # ุฅูุดุงุก ูููุฏ ุงูุชุฑุฎูุต
    generator = LicenseGenerator()
    
    # ุชูููุฏ ุงูุชุฑุฎูุต
    print(f"๐ ุชูููุฏ ุชุฑุฎูุต ููุนููู: {client_info['company_name']}")
    license_key = generator.create_license(client_info)
    
    # ูู ุชุดููุฑ ูุนุฑุถ ุงูุชูุงุตูู
    license_details = generator.decode_license(license_key)
    
    # ุญูุธ ุงูุชุฑุฎูุต
    license_filename = f"license_{client_info['client_code']}.key"
    with open(license_filename, "w") as f:
        f.write(license_key)
    
    # ุญูุธ ุชูุงุตูู ุงูุชุฑุฎูุต
    details_filename = f"license_{client_info['client_code']}_details.json"
    with open(details_filename, "w", encoding="utf-8") as f:
        json.dump(license_details, f, ensure_ascii=False, indent=2)
    
    # ุทุจุงุนุฉ ุงููุชุงุฆุฌ
    print("โ ุชู ุฅูุดุงุก ุงูุชุฑุฎูุต ุจูุฌุงุญ!")
    print(f"๐ ููู ุงูุชุฑุฎูุต: {license_filename}")
    print(f"๐ ุชูุงุตูู ุงูุชุฑุฎูุต: {details_filename}")
    print(f"๐ ููุชุงุญ ุงูุชุฑุฎูุต: {license_key[:50]}...")
    print(f"๐ ูุนุฑู ุงูุชุฑุฎูุต: {license_details['license_id']}")
    print(f"๐ ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ: {license_details['issue_date'][:10]}")
    print(f"๐ก๏ธ ุงูุชูุงุก ุงูุฏุนู: {license_details['support_expires'][:10]}")


if __name__ == "__main__":
    main()
```

### 3. ุจูุงุก ุญุฒูุฉ ุงูุนููู
```bash
#!/bin/bash
# scripts/developer/build_client_package.sh

CLIENT_CODE="$1"
VERSION="$2"

if [ -z "$CLIENT_CODE" ]; then
    echo "ุงูุงุณุชุฎุฏุงู: $0 <ููุฏ_ุงูุนููู> [ุงูุฅุตุฏุงุฑ]"
    exit 1
fi

VERSION=${VERSION:-"$(date +%Y.%m.%d)"}
PACKAGE_NAME="universal-workshop-${CLIENT_CODE}-v${VERSION}"
BUILD_DIR="builds/$PACKAGE_NAME"

echo "๐ฆ ุจูุงุก ุญุฒูุฉ ุงูุนููู: $CLIENT_CODE"

# ุฅูุดุงุก ูุฌูุฏ ุงูุจูุงุก
mkdir -p "$BUILD_DIR"

# ูุณุฎ ุงููููุงุช ุงูุฃุณุงุณูุฉ
echo "๐ ูุณุฎ ุงููููุงุช ุงูุฃุณุงุณูุฉ..."
cp -r apps/universal_workshop "$BUILD_DIR/"
cp -r apps/erpnext "$BUILD_DIR/"
cp -r apps/frappe "$BUILD_DIR/"

# ูุณุฎ ุณูุฑูุจุชุงุช ุงูุชุซุจูุช
mkdir -p "$BUILD_DIR/installation"
cp scripts/installation/* "$BUILD_DIR/installation/"

# ูุณุฎ ุงููุซุงุฆู
mkdir -p "$BUILD_DIR/docs"
cp -r docs/ar "$BUILD_DIR/docs/"
cp -r docs/en "$BUILD_DIR/docs/"

# ุฅูุดุงุก ููู ูุนูููุงุช ุงูุญุฒูุฉ
cat > "$BUILD_DIR/package_info.json" << EOF
{
    "package_name": "$PACKAGE_NAME",
    "client_code": "$CLIENT_CODE",
    "version": "$VERSION",
    "build_date": "$(date -I)",
    "system_version": "Universal Workshop ERP v2.0",
    "platform": "ERPNext 15+ / Frappe Framework",
    "license_type": "Permanent Full + Scrap Management",
    "components": [
        "universal_workshop",
        "erpnext", 
        "frappe",
        "installation_scripts",
        "documentation",
        "support_tools"
    ]
}
EOF

# ุฅูุดุงุก ุณูุฑูุจุช ุงูุชุซุจูุช ุงูููุญุฏ
cat > "$BUILD_DIR/install.sh" << 'EOF'
#!/bin/bash
# Universal Workshop ERP - Client Installation Package

echo "๐ Universal Workshop ERP v2.0 Installation"
echo "============================================"

# ูุญุต ุตูุงุญูุงุช ุงูุฌุฐุฑ
if [ "$EUID" -ne 0 ]; then
    echo "ูุฑุฌู ุชุดุบูู ุงูุณูุฑูุจุช ุจุตูุงุญูุงุช ุงูุฌุฐุฑ: sudo ./install.sh"
    exit 1
fi

# ูุฑุงุกุฉ ูุนูููุงุช ุงูุญุฒูุฉ
if [ -f "package_info.json" ]; then
    CLIENT_CODE=$(grep -o '"client_code": "[^"]*' package_info.json | cut -d'"' -f4)
    VERSION=$(grep -o '"version": "[^"]*' package_info.json | cut -d'"' -f4)
    echo "๐ฆ ุชุซุจูุช ุญุฒูุฉ ุงูุนููู: $CLIENT_CODE"
    echo "๐ ุงูุฅุตุฏุงุฑ: $VERSION"
else
    echo "โ ููู ูุนูููุงุช ุงูุญุฒูุฉ ุบูุฑ ููุฌูุฏ"
    exit 1
fi

# ุชุดุบูู ุณูุฑูุจุช ุงูุชุซุจูุช
if [ -f "installation/client_installer.sh" ]; then
    chmod +x installation/client_installer.sh
    ./installation/client_installer.sh "$CLIENT_CODE"
else
    echo "โ ุณูุฑูุจุช ุงูุชุซุจูุช ุบูุฑ ููุฌูุฏ"
    exit 1
fi
EOF

chmod +x "$BUILD_DIR/install.sh"

# ุถุบุท ุงูุญุฒูุฉ
echo "๐๏ธ ุถุบุท ุงูุญุฒูุฉ..."
tar -czf "${PACKAGE_NAME}.tar.gz" -C builds "$PACKAGE_NAME"

# ุฅูุดุงุก checksum
echo "๐ ุฅูุดุงุก checksum..."
sha256sum "${PACKAGE_NAME}.tar.gz" > "${PACKAGE_NAME}.sha256"

# ุชูุธูู ูุฌูุฏ ุงูุจูุงุก ุงููุคูุช
rm -rf "$BUILD_DIR"

echo "โ ุชู ุจูุงุก ุงูุญุฒูุฉ ุจูุฌุงุญ!"
echo "๐ฆ ุงุณู ุงูุญุฒูุฉ: ${PACKAGE_NAME}.tar.gz"
echo "๐ Checksum: ${PACKAGE_NAME}.sha256"
echo "๐ ุญุฌู ุงูุญุฒูุฉ: $(du -h ${PACKAGE_NAME}.tar.gz | cut -f1)"
```

---

## ๐ ุณูุฑูุจุชุงุช ุงูุชุซุจูุช

### 1. ูุซุจุช ุงูุนููู ุงูุฑุฆูุณู
```bash
#!/bin/bash
# scripts/installation/client_installer.sh

set -e

CLIENT_CODE="$1"
INSTALL_LOG="/var/log/workshop-install-${CLIENT_CODE}.log"

# ุงูุชุญูู ูู ุงููุนุงููุงุช
if [ -z "$CLIENT_CODE" ]; then
    echo "ุงูุงุณุชุฎุฏุงู: $0 <ููุฏ_ุงูุนููู>"
    exit 1
fi

# ุฏุงูุฉ ุงูุชุณุฌูู
log_message() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a "$INSTALL_LOG"
}

log_message "๐ ุจุฏุก ุชุซุจูุช ูุธุงู ุฅุฏุงุฑุฉ ุงููุฑุด ุงูุดุงูู ููุนููู: $CLIENT_CODE"

# ูุญุต ุงููุธุงู
log_message "๐ ูุญุต ูุชุทูุจุงุช ุงููุธุงู..."

# ูุญุต ูุธุงู ุงูุชุดุบูู
if ! grep -q "Ubuntu\|Debian" /etc/os-release; then
    log_message "โ ูุธุงู ุงูุชุดุบูู ุบูุฑ ูุฏุนูู. ูุชุทูุจ Ubuntu 20.04+ ุฃู Debian 10+"
    exit 1
fi

# ูุญุต ุงููุณุงุญุฉ ุงููุชุงุญุฉ (5GB ุนูู ุงูุฃูู)
AVAILABLE_SPACE=$(df / | awk 'NR==2 {print $4}')
if [ "$AVAILABLE_SPACE" -lt 5242880 ]; then  # 5GB in KB
    log_message "โ ูุณุงุญุฉ ุงููุฑุต ุบูุฑ ูุงููุฉ. ูุชุทูุจ 5GB ุนูู ุงูุฃูู"
    exit 1
fi

# ูุญุต ุงูุฐุงูุฑุฉ (4GB ุนูู ุงูุฃูู)
TOTAL_RAM=$(free -m | awk 'NR==2{print $2}')
if [ "$TOTAL_RAM" -lt 4000 ]; then
    log_message "โ ุงูุฐุงูุฑุฉ ุบูุฑ ูุงููุฉ. ูุชุทูุจ 4GB ุนูู ุงูุฃูู"
    exit 1
fi

log_message "โ ูุญุต ุงููุธุงู ููุชูู"

# ุชุญุฏูุซ ุงููุธุงู
log_message "๐ฆ ุชุญุฏูุซ ุญุฒู ุงููุธุงู..."
apt update && apt upgrade -y

# ุชุซุจูุช ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ
log_message "๐ง ุชุซุจูุช ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ..."
apt install -y \
    python3 python3-pip python3-venv python3-dev \
    nodejs npm \
    mariadb-server mariadb-client \
    redis-server \
    nginx \
    supervisor \
    git \
    curl \
    wget \
    unzip \
    software-properties-common \
    build-essential

# ุชูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช
log_message "๐๏ธ ุชูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช..."
systemctl start mariadb
systemctl enable mariadb

# ุชุฃููู MariaDB
mysql_secure_installation_script() {
    mysql -e "UPDATE mysql.user SET Password=PASSWORD('$(openssl rand -base64 32)') WHERE User='root';"
    mysql -e "DELETE FROM mysql.user WHERE User='';"
    mysql -e "DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');"
    mysql -e "DROP DATABASE IF EXISTS test;"
    mysql -e "DELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';"
    mysql -e "FLUSH PRIVILEGES;"
}

mysql_secure_installation_script

# ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุงูุนููู
DB_PASSWORD=$(openssl rand -base64 32)
mysql -e "CREATE DATABASE ${CLIENT_CODE}_workshop CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
mysql -e "CREATE USER '${CLIENT_CODE}_user'@'localhost' IDENTIFIED BY '$DB_PASSWORD';"
mysql -e "GRANT ALL PRIVILEGES ON ${CLIENT_CODE}_workshop.* TO '${CLIENT_CODE}_user'@'localhost';"
mysql -e "FLUSH PRIVILEGES;"

# ุญูุธ ูููุฉ ูุฑูุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo "$DB_PASSWORD" > "/root/.${CLIENT_CODE}_db_password"
chmod 600 "/root/.${CLIENT_CODE}_db_password"

log_message "โ ุชู ุชูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช"

# ุชุซุจูุช Node.js ุงูุฅุตุฏุงุฑ ุงูุตุญูุญ
log_message "๐ฆ ุชุซุจูุช Node.js..."
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt-get install -y nodejs

# ุชุซุจูุช Yarn
npm install -g yarn

# ุฅูุดุงุก ูุณุชุฎุฏู frappe
log_message "๐ค ุฅูุดุงุก ูุณุชุฎุฏู frappe..."
if ! id "frappe" &>/dev/null; then
    useradd -m -s /bin/bash frappe
    usermod -aG sudo frappe
fi

# ุชุซุจูุช frappe-bench
log_message "๐๏ธ ุชุซุจูุช frappe-bench..."
pip3 install frappe-bench

# ุฅูุดุงุก bench ููุนููู
log_message "โ๏ธ ุฅูุดุงุก bench ููุนููู..."
BENCH_DIR="/opt/workshop-${CLIENT_CODE}"
mkdir -p "$BENCH_DIR"
chown frappe:frappe "$BENCH_DIR"

sudo -u frappe bash -c "
    cd $BENCH_DIR
    bench init --frappe-branch version-15 bench
"

# ุงูุงูุชูุงู ููุฌูุฏ bench
cd "$BENCH_DIR/bench"

# ุฅุถุงูุฉ ุงูุชุทุจููุงุช
log_message "๐ฑ ุฅุถุงูุฉ ุงูุชุทุจููุงุช..."
sudo -u frappe bench get-app --branch version-15 erpnext
sudo -u frappe bench get-app universal_workshop /path/to/universal_workshop

# ุฅูุดุงุก ุงููููุน
SITE_DOMAIN="${CLIENT_CODE}.workshop.local"
ADMIN_PASSWORD=$(openssl rand -base64 16)

log_message "๐ ุฅูุดุงุก ุงููููุน: $SITE_DOMAIN"
sudo -u frappe bench new-site "$SITE_DOMAIN" \
    --admin-password "$ADMIN_PASSWORD" \
    --db-name "${CLIENT_CODE}_workshop" \
    --db-user "${CLIENT_CODE}_user" \
    --db-password "$DB_PASSWORD"

# ุชุซุจูุช ุงูุชุทุจููุงุช ุนูู ุงููููุน
log_message "๐ ุชุซุจูุช ุงูุชุทุจููุงุช..."
sudo -u frappe bench --site "$SITE_DOMAIN" install-app erpnext
sudo -u frappe bench --site "$SITE_DOMAIN" install-app universal_workshop

# ุญูุธ ูููุฉ ูุฑูุฑ ุงููุฏูุฑ
echo "$ADMIN_PASSWORD" > "/root/.${CLIENT_CODE}_admin_password"
chmod 600 "/root/.${CLIENT_CODE}_admin_password"

# ุฅุนุฏุงุฏ ุงูุฅูุชุงุฌ
log_message "๐ ุฅุนุฏุงุฏ ุงูุฅูุชุงุฌ..."
sudo -u frappe bench setup production frappe --yes

# ุฅุนุฏุงุฏ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงูุชููุงุฆูุฉ
log_message "๐พ ุฅุนุฏุงุฏ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ..."
sudo -u frappe crontab -l 2>/dev/null | { cat; echo "0 2 * * * cd $BENCH_DIR/bench && bench --site $SITE_DOMAIN backup --with-files"; } | sudo -u frappe crontab -

# ุฅูุดุงุก ุชูุฑูุฑ ุงูุชุซุจูุช
INSTALL_REPORT="/root/workshop-${CLIENT_CODE}-installation-report.txt"
cat > "$INSTALL_REPORT" << EOF
=== ุชูุฑูุฑ ุชุซุจูุช ูุธุงู ุฅุฏุงุฑุฉ ุงููุฑุด ุงูุดุงูู ===

ูุนูููุงุช ุงูุนููู:
- ููุฏ ุงูุนููู: $CLIENT_CODE
- ุชุงุฑูุฎ ุงูุชุซุจูุช: $(date)
- ูุฌูุฏ ุงูุชุซุจูุช: $BENCH_DIR/bench
- ูุทุงู ุงููููุน: $SITE_DOMAIN

ูุนูููุงุช ุงููุตูู:
- ุงูุฑุงุจุท: http://$SITE_DOMAIN
- ุงููุณุชุฎุฏู: Administrator
- ูููุฉ ุงููุฑูุฑ: ูุญููุธุฉ ูู /root/.${CLIENT_CODE}_admin_password

ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- ุงุณู ูุงุนุฏุฉ ุงูุจูุงูุงุช: ${CLIENT_CODE}_workshop
- ูุณุชุฎุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช: ${CLIENT_CODE}_user
- ูููุฉ ูุฑูุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช: ูุญููุธุฉ ูู /root/.${CLIENT_CODE}_db_password

ุงููููุงุช ุงููููุฉ:
- ุณุฌู ุงูุชุซุจูุช: $INSTALL_LOG
- ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ: $BENCH_DIR/bench/sites/$SITE_DOMAIN/private/backups/
- ูููุงุช ุงูุชูููู: $BENCH_DIR/bench/sites/$SITE_DOMAIN/site_config.json

ุฃูุงูุฑ ูููุฏุฉ:
- ุจุฏุก ุงููุธุงู: cd $BENCH_DIR/bench && bench start
- ุฅููุงู ุงููุธุงู: sudo supervisorctl stop all
- ูุณุฎุฉ ุงุญุชูุงุทูุฉ: cd $BENCH_DIR/bench && bench --site $SITE_DOMAIN backup --with-files

ูุนูููุงุช ุงูุฏุนู:
- ูุงุชู: +968 95351993
- ุจุฑูุฏ ุฅููุชุฑููู: support@universal-workshop.om
EOF

log_message "โ ุชู ุงูุชุซุจูุช ุจูุฌุงุญ!"
log_message "๐ ุชูุฑูุฑ ุงูุชุซุจูุช: $INSTALL_REPORT"
log_message "๐ ูููู ุงููุตูู ูููุธุงู ุนูู: http://$SITE_DOMAIN"

echo
echo "๐ ุชู ุชุซุจูุช ูุธุงู ุฅุฏุงุฑุฉ ุงููุฑุด ุงูุดุงูู ุจูุฌุงุญ!"
echo "๐ ุงูุฑุฃ ุชูุฑูุฑ ุงูุชุซุจูุช: $INSTALL_REPORT"
echo "๐ ูุจุฏุก ุงููุธุงู: cd $BENCH_DIR/bench && sudo -u frappe bench start"
```

---

## ๐ง ุณูุฑูุจุชุงุช ุงูุตูุงูุฉ

### 1. ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงูุชููุงุฆูุฉ
```bash
#!/bin/bash
# scripts/maintenance/backup_system.sh

CLIENT_CODE="$1"
BACKUP_TYPE="${2:-full}"  # full, database, files

if [ -z "$CLIENT_CODE" ]; then
    echo "ุงูุงุณุชุฎุฏุงู: $0 <ููุฏ_ุงูุนููู> [ููุน_ุงููุณุฎุฉ: full|database|files]"
    exit 1
fi

BENCH_DIR="/opt/workshop-${CLIENT_CODE}/bench"
SITE_DOMAIN="${CLIENT_CODE}.workshop.local"
BACKUP_DIR="/var/backups/workshop-${CLIENT_CODE}"
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")

# ุงูุชุญูู ูู ูุฌูุฏ ุงููุธุงู
if [ ! -d "$BENCH_DIR" ]; then
    echo "โ ุงููุธุงู ุบูุฑ ููุฌูุฏ: $BENCH_DIR"
    exit 1
fi

# ุฅูุดุงุก ูุฌูุฏ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
mkdir -p "$BACKUP_DIR"

echo "๐พ ุจุฏุก ุงููุณุฎ ุงูุงุญุชูุงุทู ููุนููู: $CLIENT_CODE"
echo "๐ ุงูููุช: $(date)"
echo "๐ ููุน ุงููุณุฎุฉ: $BACKUP_TYPE"

cd "$BENCH_DIR"

case "$BACKUP_TYPE" in
    "full")
        echo "๐ฆ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุงููุฉ..."
        sudo -u frappe bench --site "$SITE_DOMAIN" backup --with-files
        
        # ูุณุฎ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุฅูู ูุฌูุฏ ูููุตู
        SITE_BACKUP_DIR="sites/$SITE_DOMAIN/private/backups"
        if [ -d "$SITE_BACKUP_DIR" ]; then
            LATEST_BACKUP=$(ls -t "$SITE_BACKUP_DIR"/*.sql.gz | head -1)
            LATEST_FILES=$(ls -t "$SITE_BACKUP_DIR"/*-files.tar | head -1 2>/dev/null || echo "")
            
            if [ -n "$LATEST_BACKUP" ]; then
                cp "$LATEST_BACKUP" "$BACKUP_DIR/database_${TIMESTAMP}.sql.gz"
                echo "โ ูุณุฎุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช: $BACKUP_DIR/database_${TIMESTAMP}.sql.gz"
            fi
            
            if [ -n "$LATEST_FILES" ]; then
                cp "$LATEST_FILES" "$BACKUP_DIR/files_${TIMESTAMP}.tar"
                echo "โ ูุณุฎุฉ ุงููููุงุช: $BACKUP_DIR/files_${TIMESTAMP}.tar"
            fi
        fi
        ;;
        
    "database")
        echo "๐๏ธ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ููุงุนุฏุฉ ุงูุจูุงูุงุช ููุท..."
        sudo -u frappe bench --site "$SITE_DOMAIN" backup
        
        SITE_BACKUP_DIR="sites/$SITE_DOMAIN/private/backups"
        LATEST_BACKUP=$(ls -t "$SITE_BACKUP_DIR"/*.sql.gz | head -1)
        
        if [ -n "$LATEST_BACKUP" ]; then
            cp "$LATEST_BACKUP" "$BACKUP_DIR/database_${TIMESTAMP}.sql.gz"
            echo "โ ูุณุฎุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช: $BACKUP_DIR/database_${TIMESTAMP}.sql.gz"
        fi
        ;;
        
    "files")
        echo "๐ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูููููุงุช ููุท..."
        tar -czf "$BACKUP_DIR/system_files_${TIMESTAMP}.tar.gz" \
            --exclude="sites/*/private/backups" \
            --exclude="logs" \
            --exclude="env" \
            sites/
        echo "โ ูุณุฎุฉ ุงููููุงุช: $BACKUP_DIR/system_files_${TIMESTAMP}.tar.gz"
        ;;
        
    *)
        echo "โ ููุน ูุณุฎุฉ ุบูุฑ ูุนุฑูู: $BACKUP_TYPE"
        exit 1
        ;;
esac

# ุชูุธูู ุงููุณุฎ ุงููุฏููุฉ (ุงูุงุญุชูุงุธ ุจู 30 ูุณุฎุฉ)
echo "๐งน ุชูุธูู ุงููุณุฎ ุงููุฏููุฉ..."
find "$BACKUP_DIR" -name "*.gz" -o -name "*.tar" | sort -r | tail -n +31 | xargs rm -f

# ุฅูุดุงุก ุชูุฑูุฑ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
BACKUP_REPORT="$BACKUP_DIR/backup_report_${TIMESTAMP}.txt"
cat > "$BACKUP_REPORT" << EOF
=== ุชูุฑูุฑ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ===

ุงูุนููู: $CLIENT_CODE
ุงูุชุงุฑูุฎ: $(date)
ููุน ุงููุณุฎุฉ: $BACKUP_TYPE
ุงูุญุงูุฉ: ููุชููุฉ

ุงููููุงุช ุงูููุดุฃุฉ:
$(ls -la "$BACKUP_DIR"/*_${TIMESTAMP}.* 2>/dev/null || echo "ูุง ุชูุฌุฏ ูููุงุช")

ูุณุงุญุฉ ุงููุฑุต ุงููุชุงุญุฉ:
$(df -h "$BACKUP_DIR")

ุนุฏุฏ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงูููุฌูุฏุฉ:
$(ls -1 "$BACKUP_DIR"/*.gz "$BACKUP_DIR"/*.tar 2>/dev/null | wc -l)
EOF

echo "๐ ุชูุฑูุฑ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ: $BACKUP_REPORT"
echo "โ ุชูุช ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ!"
```

### 2. ูุฑุงูุจุฉ ุตุญุฉ ุงููุธุงู
```bash
#!/bin/bash
# scripts/maintenance/monitor_health.sh

CLIENT_CODE="$1"

if [ -z "$CLIENT_CODE" ]; then
    echo "ุงูุงุณุชุฎุฏุงู: $0 <ููุฏ_ุงูุนููู>"
    exit 1
fi

BENCH_DIR="/opt/workshop-${CLIENT_CODE}/bench"
SITE_DOMAIN="${CLIENT_CODE}.workshop.local"
HEALTH_LOG="/var/log/workshop-${CLIENT_CODE}-health.log"

# ุฏุงูุฉ ุงูุชุณุฌูู
log_health() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" >> "$HEALTH_LOG"
}

echo "๐ฅ ูุญุต ุตุญุฉ ุงููุธุงู ููุนููู: $CLIENT_CODE"

# ูุญุต ูุฌูุฏ ุงููุธุงู
if [ ! -d "$BENCH_DIR" ]; then
    echo "โ ุงููุธุงู ุบูุฑ ููุฌูุฏ"
    log_health "ERROR: System not found at $BENCH_DIR"
    exit 1
fi

cd "$BENCH_DIR"

# ูุญุต ุญุงูุฉ ุงูุนูููุงุช
echo "๐ ูุญุต ุงูุนูููุงุช..."
BENCH_PROCESSES=$(ps aux | grep -E "bench|frappe" | grep -v grep | wc -l)
echo "ุนุฏุฏ ุนูููุงุช Bench ุงููุดุทุฉ: $BENCH_PROCESSES"

if [ "$BENCH_PROCESSES" -gt 0 ]; then
    echo "โ ุงููุธุงู ูุนูู"
    log_health "INFO: System is running ($BENCH_PROCESSES processes)"
else
    echo "โ๏ธ ุงููุธุงู ูุชููู"
    log_health "WARNING: System appears to be stopped"
fi

# ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo "๐๏ธ ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช..."
DB_STATUS=$(systemctl is-active mariadb)
echo "ุญุงูุฉ MariaDB: $DB_STATUS"

if [ "$DB_STATUS" = "active" ]; then
    echo "โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุนูู"
    log_health "INFO: Database is running"
    
    # ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
    if sudo -u frappe bench --site "$SITE_DOMAIN" execute frappe.db.sql --args "['SELECT 1']" >/dev/null 2>&1; then
        echo "โ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุณููู"
        log_health "INFO: Database connection is healthy"
    else
        echo "โ ูุดููุฉ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช"
        log_health "ERROR: Database connection failed"
    fi
else
    echo "โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชูููุฉ"
    log_health "ERROR: Database is not running"
fi

# ูุญุต Redis
echo "๐ด ูุญุต Redis..."
REDIS_STATUS=$(systemctl is-active redis)
echo "ุญุงูุฉ Redis: $REDIS_STATUS"

if [ "$REDIS_STATUS" = "active" ]; then
    echo "โ Redis ูุนูู"
    log_health "INFO: Redis is running"
else
    echo "โ Redis ูุชููู"
    log_health "ERROR: Redis is not running"
fi

# ูุญุต ุงููุณุงุญุฉ ุงููุชุงุญุฉ
echo "๐พ ูุญุต ูุณุงุญุฉ ุงููุฑุต..."
DISK_USAGE=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')
echo "ุงุณุชุฎุฏุงู ุงููุฑุต: ${DISK_USAGE}%"

if [ "$DISK_USAGE" -lt 80 ]; then
    echo "โ ูุณุงุญุฉ ุงููุฑุต ูุงููุฉ"
    log_health "INFO: Disk usage is $DISK_USAGE%"
elif [ "$DISK_USAGE" -lt 90 ]; then
    echo "โ๏ธ ูุณุงุญุฉ ุงููุฑุต ููุฎูุถุฉ (${DISK_USAGE}%)"
    log_health "WARNING: Disk usage is high ($DISK_USAGE%)"
else
    echo "โ ูุณุงุญุฉ ุงููุฑุต ููุชูุฆุฉ ุชูุฑูุจุงู (${DISK_USAGE}%)"
    log_health "ERROR: Disk usage is critical ($DISK_USAGE%)"
fi

# ูุญุต ุงูุฐุงูุฑุฉ
echo "๐ง ูุญุต ุงูุฐุงูุฑุฉ..."
MEMORY_USAGE=$(free | awk 'NR==2{printf "%.0f", $3*100/$2}')
echo "ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ: ${MEMORY_USAGE}%"

if [ "$MEMORY_USAGE" -lt 80 ]; then
    echo "โ ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ ุทุจูุนู"
    log_health "INFO: Memory usage is $MEMORY_USAGE%"
elif [ "$MEMORY_USAGE" -lt 90 ]; then
    echo "โ๏ธ ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ ูุฑุชูุน (${MEMORY_USAGE}%)"
    log_health "WARNING: Memory usage is high ($MEMORY_USAGE%)"
else
    echo "โ ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ ุญุฑุฌ (${MEMORY_USAGE}%)"
    log_health "ERROR: Memory usage is critical ($MEMORY_USAGE%)"
fi

# ูุญุต ุงูุดุจูุฉ (ุฅุฐุง ูุงู ุงููุธุงู ูุนูู)
if [ "$BENCH_PROCESSES" -gt 0 ]; then
    echo "๐ ูุญุต ุงูุดุจูุฉ..."
    if nc -z localhost 8000 2>/dev/null; then
        echo "โ ุงููููุฐ 8000 ููุชูุญ"
        log_health "INFO: Port 8000 is accessible"
        
        # ุงุฎุชุจุงุฑ HTTP response
        HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8000 || echo "000")
        if [ "$HTTP_STATUS" = "200" ]; then
            echo "โ ุงููููุน ูุณุชุฌูุจ ุจุดูู ุทุจูุนู"
            log_health "INFO: Website is responding normally"
        else
            echo "โ๏ธ ุงููููุน ูุนุทู ุงุณุชุฌุงุจุฉ ุบูุฑ ุทุจูุนูุฉ: $HTTP_STATUS"
            log_health "WARNING: Website response code: $HTTP_STATUS"
        fi
    else
        echo "โ ุงููููุฐ 8000 ูุบูู"
        log_health "ERROR: Port 8000 is not accessible"
    fi
fi

# ูุญุต ุขุฎุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ
echo "๐พ ูุญุต ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ..."
BACKUP_DIR="sites/$SITE_DOMAIN/private/backups"
if [ -d "$BACKUP_DIR" ]; then
    LATEST_BACKUP=$(ls -t "$BACKUP_DIR"/*.sql.gz 2>/dev/null | head -1)
    if [ -n "$LATEST_BACKUP" ]; then
        BACKUP_AGE=$(( ($(date +%s) - $(stat -c %Y "$LATEST_BACKUP")) / 86400 ))
        echo "ุขุฎุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ: ูุจู $BACKUP_AGE ุฃูุงู"
        
        if [ "$BACKUP_AGE" -le 1 ]; then
            echo "โ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุญุฏูุซุฉ"
            log_health "INFO: Latest backup is $BACKUP_AGE days old"
        elif [ "$BACKUP_AGE" -le 7 ]; then
            echo "โ๏ธ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ูุฏููุฉ ูุณุจูุงู ($BACKUP_AGE ุฃูุงู)"
            log_health "WARNING: Latest backup is $BACKUP_AGE days old"
        else
            echo "โ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ูุฏููุฉ ุฌุฏุงู ($BACKUP_AGE ุฃูุงู)"
            log_health "ERROR: Latest backup is too old ($BACKUP_AGE days)"
        fi
    else
        echo "โ ูุง ุชูุฌุฏ ูุณุฎ ุงุญุชูุงุทูุฉ"
        log_health "ERROR: No backups found"
    fi
else
    echo "โ ูุฌูุฏ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุบูุฑ ููุฌูุฏ"
    log_health "ERROR: Backup directory not found"
fi

echo "๐ ุชู ุงูุงูุชูุงุก ูู ูุญุต ุตุญุฉ ุงููุธุงู"
echo "๐ ุงูุณุฌู: $HEALTH_LOG"
```

---

ูุฐู ุงูุณูุฑูุจุชุงุช ุชููุฑ ุญููู ุดุงููุฉ ูุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ููู ูุฑุญูุฉ ูู ูุฑุงุญู ุชุทููุฑ ูุชุณููู ุงููุธุงู. ูู ุณูุฑูุจุช ููุชูุจ ุจุนูุงูุฉ ููุชุถูู:

โ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุงูุชุญูู ูู ุงูุตุญุฉ**  
โ **ุฑุณุงุฆู ูุงุถุญุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ**  
โ **ุชุณุฌูู ููุตู ููุนูููุงุช**  
โ **ุฅูุดุงุก ุชูุงุฑูุฑ ุชููุงุฆูุฉ**  
โ **ุฅุฌุฑุงุกุงุช ุงูุฃูุงู ุงูููุงุณุจุฉ**  

ูู ุชุฑูุฏ ุฃู ุฃุถูู ุงููุฒูุฏ ูู ุงูุณูุฑูุจุชุงุช ุฃู ุฃูุถุญ ุฃู ุฌุฒุก ูุนููุ
